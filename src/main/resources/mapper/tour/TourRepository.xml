<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.inseoul.tour.repository.TourRepository">

    <insert id="save" parameterType="com.inseoul.tour.domain.Item"
            useGeneratedKeys="true" keyColumn="tour_id" keyProperty="tourId">
        INSERT INTO tour
        (tour_name, tour_addr1, tour_addr2, tour_image1, tour_image2, tour_contentid, tour_sigungucode, tour_mapx, tour_mapy)
        VALUES
            (#{tourName}, #{tourAddr1}, #{tourAddr2}, #{tourImage1}, #{tourImage2}, #{tourContentid}, #{tourSigungucode}, #{tourMapx}, #{tourMapy})
    </insert>

    <sql id="SELECT_BASE">
        SELECT tour_id "tourId",
               tour_name "tourName",
               tour_addr1 "tourAddr1",
               tour_addr2 "tourAddr2",
               tour_image1 "tourImage1",
               tour_image2 "tourImage2",
               tour_contentid "tourContentid",
               tour_sigungucode "tourSigungucode",
               tour_mapx "tourMapx",
               tour_mapy "tourMapy"
        FROM tour
        WHERE 1 = 1
    </sql>

    <resultMap id="mapTourInfoSaved" type="com.inseoul.user.domain.UserScraptedTour">
        <result column="tour_scrapted_id" property="tourScraptedId"/>
        <result column="tour_id" property="tourId"/>
        <result column="id" property="userId"/>
    </resultMap>

    <resultMap id="mapTour" type="com.inseoul.tour.domain.Item">
        <result column="tour_id" property="tourId"/>
        <result column="tour_name" property="tourName"/>
        <result column="tour_addr1" property="tourAddr1"/>
        <result column="tour_addr2" property="tourAddr2"/>
        <result column="tour_image1" property="tourImage1"/>
        <result column="tour_image2" property="tourImage2"/>
        <result column="tour_contentid" property="tourContentid"/>
        <result column="tour_sigungucode" property="tourSigungucode"/>
        <result column="tour_mapx" property="tourMapx"/>
        <result column="tour_mapy" property="tourMapy"/>
    </resultMap>

    <select id="selectById" resultType="com.inseoul.tour.domain.Item">
        <include refid="SELECT_BASE"/>
        AND tour_id = #{tourId}
    </select>

    <select id="selectFromRow" resultType="com.inseoul.tour.domain.Item">
        <include refid="SELECT_BASE"/>
        AND tour_sigungucode = #{tourSigungucode} AND tour_name LIKE concat("%", #{tourName}, "%")
        ORDER BY tour_id DESC
        LIMIT #{param3}, #{param4}
    </select>

    <select id="countAll" resultType="java.lang.Integer">
        SELECT count(tour_id) FROM tour
        WHERE tour_sigungucode = #{tourSigungucode} AND tour_name LIKE concat("%", #{tourName}, "%")
    </select>

    <select id="getRandomTourCard" resultType="com.inseoul.tour.domain.Item">
        <include refid="SELECT_BASE"/>
        ORDER BY RAND()
        LIMIT 4
    </select>
    <select id="findById" resultType="com.inseoul.tour.domain.Item"></select>

</mapper>
